singleton VFS {
	new_instance, errno_t, out obj vfs_instance_t instance;
}

obj vfs_wrapped_handle_t {}

obj vfs_instance_t {
	clone, errno_t, int oldfd, int newfd, bool desc, out int outfd;
	fsprobe, errno_t, service_id_t service_id, in str *fs_name, out vfs_fs_probe_info_t *info;
	fstypes, errno_t, out *fstypes;
	mount, errno_t, int mpfd, service_id_t service_id, unsigned flags, unsigned instance, in str *opts, in str *fs_name, out int outfd;
	open, errno_t, int fd, int mode;
	put, errno_t, int fd;
	read, errno_t, int fd, in64 aoff64_t pos, out *buffer, out size_t read;
	rename, errno_t, int basefd, in str *old, in str *new;
	resize, errno_t, int fd, in64 int64_t size;
	stat, errno_t, int fd, out vfs_stat_t *data;
	statfs, errno_t, int fd, out vfs_statfs_t *data;
	sync, errno_t, int fd;
	unlink, errno_t, int parentfd, int expectfd, in str *path;
	unmount, errno_t, int mpfd;
	wrap_handle, errno_t, int fd, out obj vfs_wrapped_handle_t handle;
	unwrap_handle, errno_t, obj vfs_wrapped_handle_t handle, bool high_fd, out int fd;
	walk, errno_t, int parentfd, int flags, in str *path, out int fd;
	write, errno_t, int fd, in64 aoff64_t pos, in *buffer, out size_t written;
}

server vfs_instance_t {
	@default, vfs_op_*;
	@enum_prefix, VFS_IN_;
	fsprobe, vfs_in_fsprobe;
	fstypes, vfs_in_fstypes;
	read, vfs_op_read_direct;
	rename, vfs_in_rename;
	stat, vfs_op_stat_direct;
	statfs, vfs_op_statfs_direct;
	wrap_handle, vfs_in_wrap_handle, encapsulate:handle;
	unwrap_handle, vfs_in_unwrap_handle, decapsulate:handle;
	write, vfs_op_write_direct;
}
